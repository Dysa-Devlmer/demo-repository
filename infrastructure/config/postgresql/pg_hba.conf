# =============================================================================
# ðŸš€ CHATBOTDYSA ENTERPRISE+++++ POSTGRESQL HOST-BASED AUTHENTICATION
# Enterprise Security Configuration for Database Access Control
# =============================================================================

# PostgreSQL Client Authentication Configuration File
# ===================================================
#
# Refer to the "Client Authentication" section in the PostgreSQL
# documentation for a complete description of this file.
#
# TYPE  DATABASE        USER            ADDRESS                 METHOD

# -----------------------------------------------------------------------------
# ENTERPRISE LOCAL CONNECTIONS
# -----------------------------------------------------------------------------

# Local socket connections for superuser and maintenance
local   all             postgres                                peer

# Local socket connections for application users with password
local   all             chatbot_admin                           scram-sha-256
local   all             chatbot_app                             scram-sha-256
local   all             chatbot_readonly                        scram-sha-256

# Allow local connections for replication
local   replication     postgres                                peer
local   replication     replicator                              scram-sha-256

# -----------------------------------------------------------------------------
# ENTERPRISE IPv4 CONNECTIONS
# -----------------------------------------------------------------------------

# Superuser access from localhost only (with password)
host    all             postgres        127.0.0.1/32            scram-sha-256
host    all             postgres        ::1/128                 scram-sha-256

# Application database connections - ChatBotDysa Enterprise
host    chatbotdysa_enterprise  chatbot_admin    127.0.0.1/32    scram-sha-256
host    chatbotdysa_enterprise  chatbot_app      127.0.0.1/32    scram-sha-256
host    chatbotdysa_enterprise  chatbot_readonly 127.0.0.1/32    scram-sha-256

# Docker network connections (adjust subnet as needed)
host    chatbotdysa_enterprise  chatbot_admin    172.16.0.0/12   scram-sha-256
host    chatbotdysa_enterprise  chatbot_app      172.16.0.0/12   scram-sha-256
host    chatbotdysa_enterprise  chatbot_readonly 172.16.0.0/12   scram-sha-256

# Kubernetes cluster connections (adjust as needed)
host    chatbotdysa_enterprise  chatbot_admin    10.0.0.0/8      scram-sha-256
host    chatbotdysa_enterprise  chatbot_app      10.0.0.0/8      scram-sha-256
host    chatbotdysa_enterprise  chatbot_readonly 10.0.0.0/8      scram-sha-256

# Private network connections (Enterprise LAN)
host    chatbotdysa_enterprise  chatbot_admin    192.168.0.0/16  scram-sha-256
host    chatbotdysa_enterprise  chatbot_app      192.168.0.0/16  scram-sha-256
host    chatbotdysa_enterprise  chatbot_readonly 192.168.0.0/16  scram-sha-256

# -----------------------------------------------------------------------------
# ENTERPRISE IPv6 CONNECTIONS
# -----------------------------------------------------------------------------

# Local IPv6 connections
host    chatbotdysa_enterprise  chatbot_admin    ::1/128         scram-sha-256
host    chatbotdysa_enterprise  chatbot_app      ::1/128         scram-sha-256
host    chatbotdysa_enterprise  chatbot_readonly ::1/128         scram-sha-256

# -----------------------------------------------------------------------------
# REPLICATION CONNECTIONS - Enterprise High Availability
# -----------------------------------------------------------------------------

# Master-slave replication (adjust IPs for your replica servers)
host    replication     replicator      127.0.0.1/32            scram-sha-256
host    replication     replicator      192.168.1.10/32         scram-sha-256
host    replication     replicator      192.168.1.11/32         scram-sha-256
host    replication     replicator      192.168.1.12/32         scram-sha-256

# Cloud replication (for AWS, Azure, GCP)
# Uncomment and adjust for your cloud provider's IP ranges
# host    replication     replicator      10.0.0.0/16             scram-sha-256

# -----------------------------------------------------------------------------
# SSL CONNECTIONS - Enterprise Security
# -----------------------------------------------------------------------------

# Force SSL for external connections (production requirement)
hostssl chatbotdysa_enterprise  chatbot_admin    0.0.0.0/0       scram-sha-256
hostssl chatbotdysa_enterprise  chatbot_app      0.0.0.0/0       scram-sha-256
hostssl chatbotdysa_enterprise  chatbot_readonly 0.0.0.0/0       scram-sha-256

# SSL replication for external replicas
hostssl replication     replicator      0.0.0.0/0               scram-sha-256

# -----------------------------------------------------------------------------
# MONITORING AND MANAGEMENT CONNECTIONS
# -----------------------------------------------------------------------------

# PostgreSQL monitoring tools (pgAdmin, Grafana, etc.)
host    postgres        postgres        127.0.0.1/32            scram-sha-256
host    postgres        monitoring      127.0.0.1/32            scram-sha-256
host    postgres        monitoring      192.168.0.0/16          scram-sha-256

# Backup user connections
host    all             backup_user     127.0.0.1/32            scram-sha-256
host    all             backup_user     192.168.0.0/16          scram-sha-256

# -----------------------------------------------------------------------------
# DEVELOPMENT AND TESTING (DISABLE IN PRODUCTION)
# -----------------------------------------------------------------------------

# Development connections (comment out in production)
# host    chatbotdysa_dev     dev_user        192.168.0.0/16      scram-sha-256
# host    chatbotdysa_test    test_user       192.168.0.0/16      scram-sha-256

# -----------------------------------------------------------------------------
# ENTERPRISE SECURITY POLICIES
# -----------------------------------------------------------------------------

# DENY ALL OTHER CONNECTIONS
# This should be the last line to ensure security
# Any connection not explicitly allowed above will be denied

# Optional: Log rejected connections for security monitoring
# host    all             all             0.0.0.0/0               reject

# -----------------------------------------------------------------------------
# NOTES FOR ENTERPRISE DEPLOYMENT:
# -----------------------------------------------------------------------------
# 1. Always use scram-sha-256 for password authentication (strongest available)
# 2. Never use 'trust' method in production
# 3. Restrict database access to specific users and databases
# 4. Use SSL (hostssl) for all external connections
# 5. Regularly audit and update IP address ranges
# 6. Monitor failed authentication attempts
# 7. Use certificate authentication (cert) for highest security when possible
# 8. Implement connection limits per user in postgresql.conf
# 9. Consider using pg_bouncer for connection pooling
# 10. Regular security audits of authentication rules
#
# For certificate authentication (highest security):
# hostssl chatbotdysa_enterprise  chatbot_admin    0.0.0.0/0       cert clientcert=verify-full
#
# For LDAP integration (enterprise environments):
# host    chatbotdysa_enterprise  all              192.168.0.0/16  ldap ldapserver=ldap.company.com ldapbasedn="dc=company,dc=com" ldapbinddn="cn=postgres,ou=service,dc=company,dc=com"
#
# For Kerberos authentication (enterprise SSO):
# host    chatbotdysa_enterprise  all              192.168.0.0/16  gss include_realm=0 krb_realm=COMPANY.COM
# =============================================================================